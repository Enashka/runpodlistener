# RunPod ComfyUI Image Sync

A tool to automatically sync images generated by ComfyUI on RunPod to Google Drive.

## Overview

This application monitors the output directory of ComfyUI on RunPod and automatically uploads new images to Google Drive as they are generated. This allows for seamless access to your AI-generated images on your local machine through Google Drive sync.

## Features

- Monitors ComfyUI output directory on RunPod
- Automatically uploads new images to Google Drive
- Configurable sync intervals
- Authentication with Google Drive API
- Logging and error handling

## Requirements

- Python 3.8+
- RunPod account with ComfyUI setup
- Google Drive account
- Google Cloud Platform account (for API access)

## Setup

### 1. Clone this repository

```bash
git clone https://github.com/yourusername/runpodlistener.git
cd runpodlistener
```

### 2. Set up Google Drive API

1. Go to the [Google Cloud Console](https://console.cloud.google.com/)
2. Create a new project
3. Enable the Google Drive API
   - Go to "APIs & Services" > "Library"
   - Search for "Google Drive API" and enable it
4. Create OAuth credentials
   - Go to "APIs & Services" > "Credentials"
   - Click "Create Credentials" > "OAuth client ID"
   - Select "Desktop app" as the application type
   - Name your client and click "Create"
5. Download the credentials JSON file
6. Rename it to `credentials.json` and place it in the project directory

### 3. Configure the application

1. Copy the example environment file:
   ```bash
   cp .env.example .env
   ```

2. Edit the `.env` file with your specific settings:
   - `RUNPOD_API_KEY`: Your RunPod API key (found in your RunPod account settings)
   - `RUNPOD_POD_ID`: The ID of your RunPod pod running ComfyUI
   - `GOOGLE_DRIVE_FOLDER_ID`: The ID of the Google Drive folder where you want to store the images
     - You can find this in the URL when you open the folder in Google Drive: `https://drive.google.com/drive/folders/YOUR_FOLDER_ID`

### 4. Install dependencies

```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
pip install -r requirements.txt
```

## Usage

### Running locally

To run the sync application locally:

```bash
python src/main.py
```

Options:
- `--once`: Run the sync once and exit
- `--config`: Path to a custom .env file

### Running on RunPod

To run the application on RunPod:

1. Upload the entire project to your RunPod pod
2. SSH into your RunPod pod
3. Navigate to the project directory
4. Make the run script executable:
   ```bash
   chmod +x run_on_runpod.sh
   ```
5. Run the script:
   ```bash
   ./run_on_runpod.sh
   ```

## First Run Authentication

The first time you run the application, it will open a browser window asking you to authenticate with Google. Follow these steps:

1. Sign in to your Google account
2. Grant the requested permissions
3. Copy the authorization code
4. Paste it into the terminal when prompted

After the first authentication, a token file will be created and stored for future use.

## Troubleshooting

### Authentication Issues

If you encounter authentication issues:
1. Delete the `token.json` file
2. Ensure your `credentials.json` file is correct
3. Run the application again to re-authenticate

### RunPod API Issues

If you encounter issues with the RunPod API:
1. Verify your API key is correct
2. Ensure your Pod ID is correct
3. Check that your pod is running

## License

MIT
