# ComfyUI Image Sync Tool

A simple tool to automatically sync images generated by ComfyUI on RunPod to Google Drive. Perfect for keeping your generated images backed up and accessible.

## Prerequisites

Before you begin, you'll need:
1. A RunPod instance with ComfyUI installed
2. A Google Cloud project with the Drive API enabled
3. OAuth 2.0 credentials (`credentials.json`) - [How to get credentials](#getting-google-drive-api-credentials)
4. A Google Drive folder ID - [How to get folder ID](#getting-your-google-drive-folder-id)

## Quick Start

1. **Stop any existing sync service** (if updating):
   ```bash
   pkill -f minimal_sync.py
   ```

2. **Set up the tool**:
   ```bash
   # Create directory and move into it
   mkdir -p /workspace/runpodlistener
   cd /workspace/runpodlistener
   
   # Download and run setup script
   curl -O https://raw.githubusercontent.com/Enashka/runpodlistener/main/setup_sync.sh
   chmod +x setup_sync.sh
   ./setup_sync.sh
   ```

3. **Follow the prompts**:
   - Provide your Google Drive folder ID when asked
   - Upload `credentials.json` when prompted
   - Complete Google authentication (one-time process)

4. **Start the service**:
   ```bash
   ./start.sh
   ```

That's it! The tool will now automatically upload any new images generated by ComfyUI to your Google Drive folder.

## Features

- üîÑ Real-time sync of new images to Google Drive
- üöÄ Fast startup - only processes new files
- üõ°Ô∏è Preserves configuration between pod restarts
- ‚öôÔ∏è Configurable sync interval and file types
- üìÅ Monitors ComfyUI output directory
- üîß Simple installation and setup
- üñ•Ô∏è Runs as a background service

## Usage Guide

### Checking Status

View the sync logs:
```bash
tail -f sync.log
```

### Managing the Service

Stop the service:
```bash
pkill -f minimal_sync.py
```

Restart the service:
```bash
pkill -f minimal_sync.py
./start.sh
```

### Updating the Tool

```bash
cd /workspace/runpodlistener
pkill -f minimal_sync.py
curl -O https://raw.githubusercontent.com/Enashka/runpodlistener/main/setup_sync.sh
chmod +x setup_sync.sh
./setup_sync.sh
./start.sh
```

### After Pod Restart

When you restart your RunPod instance:
1. Connect to your pod
2. Run:
   ```bash
   cd /workspace/runpodlistener
   ./setup_sync.sh
   ./start.sh
   ```

## Configuration

Edit `config.yaml` to customize the tool:

```yaml
# Google Drive folder ID for uploads
folder_id: "YOUR_FOLDER_ID"

# Check interval (seconds)
sync_interval: 5

# Directory to monitor
output_directory: "/workspace/ComfyUI/output"

# File types to sync
file_extensions:
  - ".png"
  - ".jpg"
  - ".jpeg"
```

## Getting Started Guide

### Getting Your Google Drive Folder ID

1. Open Google Drive
2. Navigate to your desired upload folder
3. The folder ID is the last part of the URL:
   ```
   https://drive.google.com/drive/folders/YOUR_FOLDER_ID
   ```

### Getting Google Drive API Credentials

1. Visit [Google Cloud Console](https://console.cloud.google.com/)
2. Create a project or select existing one
3. Enable the Google Drive API
4. Create OAuth 2.0 credentials:
   - Choose "Desktop application" type
   - Download the credentials
   - Rename the downloaded file to exactly `credentials.json`

## How It Works

The tool monitors the ComfyUI output directory for new image files created after it starts running. It:

1. Records the start time when launched
2. Monitors the output directory for new files
3. Uploads only files created after the start time
4. Maintains a list of uploaded files to prevent duplicates

This ensures:
- Fast startup (no scanning of existing files)
- No duplicate uploads
- Efficient operation

## Troubleshooting

### Common Issues

1. **Service not starting**: Check if another instance is running:
   ```bash
   ps aux | grep minimal_sync.py
   ```

2. **Upload errors**: Verify your credentials and folder ID in `config.yaml`

3. **Missing files**: Ensure the output directory exists and is correct in `config.yaml`

### Getting Help

If you encounter issues:
1. Check the logs: `tail -f sync.log`
2. Ensure all credentials are correct
3. Try stopping and restarting the service

## License

[MIT License](LICENSE)

---
*Maintained by Enashka*

